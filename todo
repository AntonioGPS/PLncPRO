Update manual
Refactor and document
